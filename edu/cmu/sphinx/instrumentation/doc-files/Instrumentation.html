<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html>
<head>
<!--

Copyright 1999-2002 Carnegie Mellon University.  
Portions Copyright 2002 Sun Microsystems, Inc.  
Portions Copyright 2002 Mitsubishi Electronic Research Laboratories.
All Rights Reserved.  Use is subject to license terms.

See the file "license.terms" for information on usage and
redistribution of this file, and for a DISCLAIMER OF ALL 
WARRANTIES.

-->
  <title>Sphinx-4 Instrumentation</title>
  <style type="text/css">
  pre { font-size: medium; background: #f0f8ff; padding: 2mm; border-style: ridge ; color: teal}
  code {font-size: medium; color: teal}
  </style>
  <meta name="author" content="Paul Lamere">
  <meta name="description"
 content="A description of how to configure and use the Sphinx-4 instrumentation classes">
</head>
<body style="background-color: white;">
<center>
<table bgcolor="#99cbff" border="0" width="100%">
  <tbody>
    <tr>
      <td align="center" width="100%">
      <h1><a name="mozTocId705774" class="mozTocH1"></a>Instrumentation
for Sphinx-4<br>
      <font size="+1"><br>
      </font></h1>
      </td>
    </tr>
  </tbody>
</table>
</center>
<font face="Arial" size="2">
<br>
</font>
<hr>
<h2><a name="mozTocId974613" class="mozTocH2"></a>Introduction</h2>
Sphinx-4 can be configured to output various collections of information
that may be useful for users and developers. This information includes:<br>
<ul>
  <li>Warning and Error messages<br>
  </li>
  <li>Logging&nbsp; /&nbsp; tracing messages</li>
  <li>Recognition results<br>
  </li>
  <li>Accuracy statistics</li>
  <li>Speed statistics</li>
  <li>Memory footprint statistics</li>
  <li>Configuration information</li>
  <li>Grammar plots</li>
  <li>Search space plots</li>
</ul>
The output of the various types of instrumentation information is
controllable from the configuration file.&nbsp; Lets look in
detail&nbsp; at what information is being displayed and how to control
what information is output.<br>
<h2>Silence is Golden</h2>
First lets look at a Sphinx-4 configuration file for a tidigits
task.&nbsp; (You can learn more about configuration files by reading <a
 href="../../util/props/doc-files/ConfigurationManagement.html">Sphinx-4
Configuration Management)</a>.&nbsp; The Sphinx-4 configuration file <a
 href="silent.config.xml">silent.config.xml</a> shows a standard
configuration for recognizing connected digits.&nbsp; It is based upon
the tidigits.config.xml found in sphinx4/tests/performance/tidigits,
except that all logging and instrumentation has been disabled.&nbsp; If
we run Sphinx-4 with this configuration we get absolutely no output:<br>
<br>
<pre>% java edu.cmu.sphinx.tools.batch.BatchModeRecognizer silent.config.xml tidigits.batch<br>% </pre>
That is probably not very useful for most applications.&nbsp; Let's
take a look to see if we can get some recognition results using the <span
 style="font-weight: bold;">Logger.</span><br>
<br>
<h2>Using the Logger</h2>
Any well behaved Sphinx components (there are some that are not so well
behaved...) that needs to output informational messages will do so via
the Sphinx-4 logger.&nbsp; These have a level of importance associated
with them. Some messages indicate <span style="font-style: italic;">severe&nbsp;
</span>problems, some messages are&nbsp; <span
 style="font-style: italic;">warnings</span>, some are <span
 style="font-style: italic;">informational,&nbsp; </span>and some are <span
 style="font-style: italic;">fine&nbsp; </span>level tracing messages.
The complete set of log levels are:<br>
<ul>
  <li>SEVERE (highest value) - an error occurs that makes continuing
the operation difficult or impossible </li>
  <li>WARNING - an anomalie has occured, but the operation is
continuing </li>
  <li>INFO - general information </li>
  <li>CONFIG - information about a components configuration </li>
  <li>FINE - tracing messages </li>
  <li>FINER - finer grained tracing messages (lots of output) </li>
  <li>FINEST (lowest value) - finest grained tracing messages (huge
amounts of output)</li>
</ul>
In&nbsp; <a
 href="file:///home/plamere/tools/eclipse/workspace/Sphinx-4/edu/cmu/sphinx/instrumentation/doc-files/silent.config.xml">silent.config.xml</a>&nbsp;<span
 style="font-style: italic;">&nbsp;</span> there is a global property
called <span style="font-style: italic;">logLevel</span> that is set
to <span style="font-style: italic;">OFF.&nbsp;</span> <br>
<pre>&lt;config&gt;<br>    &lt;property name="logLevel"     value="OFF"/&gt;<br>     &lt;!-- components omitted --&gt;<br>&lt;/config&gt;<br></pre>
This indicates that by default, no logging information will be logged
to the console at all.&nbsp; This, of course, is dangerous because we
probably want at least&nbsp; to see all warning and error
messages.&nbsp; Let's turn on warning and error messages. We do this by
setting the <span style="font-style: italic;">logLevel </span>to <span
 style="font-style: italic;">WARNING</span> like so:<br>
<pre>&lt;config&gt;<br>    &lt;property name="logLevel"     value="WARNING"/&gt;<br>     &lt;!-- components omitted --&gt;<br>&lt;/config&gt;</pre>
By setting the logLevel to WARNING, we are saying that we want to see
all log messages at the WARNING level or higher. With this setting we
should see WARNING and SEVERE messages.&nbsp; (Note that this is the
default setting anyway, so if you omit setting logLevel at the global
level, the logLevel is automatically set to WARNING).<br>
<br>
Let's run this again with our new settings:<br>
<pre>% java edu.cmu.sphinx.tools.batch.BatchModeRecognizer silent.config.xml tidigits.batch<br>% </pre>
It is still silent, which means we don't have any warning or errors in
our run.&nbsp; Now, lets see what an error looks like. To force an
error, I'll delete one of the audio input files listed in the <span
 style="font-style: italic;">tidigits.batch</span> file. This should
cause an error when the recognizer attempts to deocode the&nbsp;
missing file .&nbsp; Here's an example:<br>
<pre>% java edu.cmu.sphinx.tools.batch.BatchModeRecognizer silent.config.xml tidigits.batch<br><br> 07:37.604 SEVERE  I/O error during decoding: /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.o5o6671a.wav.raw\<br>	&nbsp;(No such file or directory) in edu.cmu.sphinx.tools.batch.BatchModeRecognizer:decode<br>%<br></pre>
This time we get a SEVERE error report showing when and where the error
occurred. Note that the log includes information such as the timetamp
for the error, the level of the error, a detailed error message and an
indication of where in the code the error occurred.<br>
<br>
Now let's restore the missing file so we don't get this error anymore
and try to get some results displayed.<br>
<br>
The JavaDocs for the <a
 href="file:///home/plamere/tools/eclipse/workspace/Sphinx-4/edu/cmu/sphinx/tools/batch/BatchModeRecognizer.html">BatchModeRecognizer</a>&nbsp;
indicate that the BatchModeRecognizer will log results at the INFO
level.&nbsp; Let's try setting the logLevel to INFO to see what the
BatchModeRecognizer reports.<br>
<pre>&lt;config&gt;<br>    &lt;property name="logLevel"     value="INFO"/&gt;<br>     &lt;!-- components omitted --&gt;<br>&lt;/config&gt;</pre>
By setting the logLevel to INFO we are enabling logs at the INFO,
WARNING and SEVERE levels.<br>
<br>
With this new setting lets run the recognizer again to see what output
we get:<br>
<pre>% java edu.cmu.sphinx.tools.batch.BatchModeRecognizer silent.config.xml tidigits.batch<br>08:23.006 INFO logMath              Log base is 1.0001<br>08:23.020 INFO logMath              Using AddTable when adding logs<br>08:23.021 INFO logMath              LogAdd table has 99022 entries.<br>08:23.683 INFO sphinx3Loader        Sphinx3Loader<br>08:23.684 INFO sphinx3Loader        Pool wd_dependent_phone.cd_continuous_8gau/means Entries: 4816<br>08:23.686 INFO sphinx3Loader        Pool wd_dependent_phone.cd_continuous_8gau/variances Entries: 4816<br>08:23.687 INFO sphinx3Loader        Pool wd_dependent_phone.cd_continuous_8gau/transition_matrices Entries: 34<br>08:23.688 INFO sphinx3Loader        Pool senones Entries: 602<br>08:23.689 INFO sphinx3Loader        Pool meanTransformationMatrix Entries: 1<br>08:23.690 INFO sphinx3Loader        Pool meanTransformationMatrix Entries: 1<br>08:23.691 INFO sphinx3Loader        Pool varianceTransformationMatrix Entries: 1<br>08:23.692 INFO sphinx3Loader        Pool varianceTransformationMatrix Entries: 1<br>08:23.693 INFO sphinx3Loader        Pool wd_dependent_phone.cd_continuous_8gau/mixture_weights Entries: 602<br>08:23.694 INFO sphinx3Loader        Pool senones Entries: 602<br>08:23.696 INFO sphinx3Loader        Context Independent Unit Entries: 34<br>08:23.697 INFO sphinx3Loader        HMM Manager: 430 hmms<br>08:23.698 INFO acousticModel        CompositeSenoneSequences: 0<br>08:23.700 INFO dictionary           Loading dictionary from: <br>08:23.701 INFO dictionary           file:/lab/speech/sphinx4/data/tidigits_8gau_13dCep_16k_40mel_130Hz_6800Hz.bin.zip/dictionary<br>08:23.712 INFO dictionary           Loading filler dictionary from: <br>08:23.714 INFO dictionary           file:/lab/speech/sphinx4/data/tidigits_8gau_13dCep_16k_40mel_130Hz_6800Hz.bin.zip/fillerdict<br>08:23.728 INFO wordListGrammar      Num nodes : 14<br>08:23.729 INFO wordListGrammar      Num arcs  : 34<br>08:23.731 INFO wordListGrammar      Avg arcs  : 2.4285715<br>08:23.306 INFO threadedScorer       # of scoring threads: 1<br>08:23.393 INFO batch                BatchDecoder: decoding files in tidigits.batch<br>08:23.173 INFO batch                File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.111a.wav.raw<br>08:23.175 INFO batch                Result: &lt;sil&gt; one one one<br>08:23.645 INFO batch                File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.139oa.wav.raw<br>08:23.647 INFO batch                Result: &lt;sil&gt; one three nine oh<br>08:24.957 INFO batch                File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.155a.wav.raw<br>08:24.958 INFO batch                Result: &lt;sil&gt; one five five<br>08:24.278 INFO batch                File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.1688a.wav.raw<br>08:24.279 INFO batch                Result: &lt;sil&gt; one six eight eight<br>08:24.987 INFO batch                File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.1a.wav.raw<br>08:24.988 INFO batch                Result: &lt;sil&gt; one<br><br></pre>
It looks like there are a number of other components that are issuing
INFO messages that are cluttering up our output.&nbsp; We'd like to be
able to turn the other INFO messages off, and just get the
BatchModeRecognizer INFO messages.&nbsp; We can do this by setting the
logLevel at the individual component level.&nbsp; Each component can
have its own individual logging level.&nbsp; This means that different
components can be logging messages at different levels.&nbsp; Since we
only want the BatchModeRecognizer to be outputing INFO messages, lets
restore the overall logging level to WARNING and set the logLevel for
'batch' (the name of the BatchModeRecognizer component) to INFO.<br>
<br>
<br>
<pre>&lt;config&gt;<br>    &lt;property name="logLevel"     value="INFO"/&gt;<br><br>    &lt;component name="batch"<br>                type="edu.cmu.sphinx.tools.batch.BatchModeRecognizer"&gt;<br>        &lt;property name="recognizer" value="connectedDigitsRecognizer"/&gt;<br>        &lt;property name="inputSource" value="streamDataSource"/&gt;<br>        &lt;property name="logLevel"     value="INFO"/&gt;<br>    &lt;/component&gt;<br><br><br>     &lt;!-- many components omitted --&gt;<br>&lt;/config&gt;</pre>
Now lets look at out output:<br>
<br>
<pre>% java -cp ../../../bld/classes/ -Dskip=20 edu.cmu.sphinx.tools.batch.BatchModeRecognizer silent.config.xml tidigits.batch<br>08:26.591 INFO batch                BatchDecoder: decoding files in tidigits.batch<br>08:26.260 INFO batch                File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.111a.wav.raw<br>08:26.262 INFO batch                Result: &lt;sil&gt; one one one<br>08:26.749 INFO batch                File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.139oa.wav.raw<br>08:26.751 INFO batch                Result: &lt;sil&gt; one three nine oh<br>08:26.105 INFO batch                File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.155a.wav.raw<br>08:26.107 INFO batch                Result: &lt;sil&gt; one five five<br>08:26.390 INFO batch                File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.1688a.wav.raw<br>08:26.391 INFO batch                Result: &lt;sil&gt; one six eight eight<br>08:26.022 INFO batch                File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.1a.wav.raw<br>08:26.023 INFO batch                Result: &lt;sil&gt; one<br>08:26.029 INFO batch                File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.1b.wav.raw<br>08:26.030 INFO batch                Result: &lt;sil&gt; one<br>08:26.048 INFO batch                File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.1za.wav.raw<br>08:26.049 INFO batch                Result: &lt;sil&gt; one zero<br><br><br></pre>
<a href="../../tools/batch/BatchModeRecognizer.html"></a>There are ways
to control the terseness of the actual output as well.&nbsp; Setting
the global property <span style="font-style: italic;">logTerse</span>
to true, will result in the ancillary information (timestamp, level,
source component) being omitted.<br>
<br>
<pre>&lt;config&gt;<br>    &lt;property name="logLevel"     value="INFO"/&gt;<br><br>    &lt;component name="batch"<br>                type="edu.cmu.sphinx.tools.batch.BatchModeRecognizer"&gt;<br>        &lt;property name="recognizer" value="connectedDigitsRecognizer"/&gt;<br>        &lt;property name="inputSource" value="streamDataSource"/&gt;<br>        &lt;property name="logLevel"     value="INFO"/&gt;<br>        &lt;property name="logTerse"     value="true"/&gt;<br>    &lt;/component&gt;<br><br>&lt;/config&gt;</pre>
Here's the terse output:<br>
<br>
<pre>% java -cp ../../../bld/classes/ -Dskip=20 edu.cmu.sphinx.tools.batch.BatchModeRecognizer silent.config.xml tidigits.batch<br>Handler java.util.logging.ConsoleHandler@cdfc9c<br>BatchDecoder: decoding files in tidigits.batch<br>File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.111a.wav.raw<br>Result: &lt;sil&gt; one one one<br>File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.139oa.wav.raw<br>Result: &lt;sil&gt; one three nine oh<br>File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.155a.wav.raw<br>Result: &lt;sil&gt; one five five<br>File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.1688a.wav.raw<br>Result: &lt;sil&gt; one six eight eight<br>File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.1a.wav.raw<br>Result: &lt;sil&gt; one<br>File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.1b.wav.raw<br>Result: &lt;sil&gt; one<br>File  : /lab/speech/sphinx4/data/tidigits/test/raw16k/man/man.ah.1za.wav.raw<br>Result: &lt;sil&gt; one zero<br><br></pre>
At this point we know enough about the logger to be able to turn it on
and off, to control the level of logging output on a per component
basis and to configure the appearance of the logging output.<br>
<br>
<br>
<hr><font face="Arial" size="2">Copyright 1999-2004 Carnegie Mellon
University.<br>
Portions Copyright 2002-2004 Sun Microsystems, Inc.<br>
Portions Copyright 2002-2004 Mitsubishi Electronic Research
Laboratories.<br>
All Rights Reserved. Usage is subject to <a href="license.terms">license
terms</a>.
</font>
</body>
</html>
